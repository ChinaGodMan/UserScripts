name: assign-pr-to-creator

on:
    pull_request:
        types: [opened]

jobs:
    assign-pr:
        runs-on: ubuntu-latest
        steps:
            - name: è‡ªåŠ¨åˆ†é…å®¡æŸ¥å’Œå—ç†è‡³äººæ°‘çš„å‹¤åŠ¡å‘˜
              uses: actions/github-script@v7
              with:
                  github-token: ${{ secrets.BOT_TOKEN }}
                  script: |
                      const prOwner = context.repo.owner;
                      const pullRequest = context.payload.pull_request;
                      const pull_number = pullRequest.number;
                      const prAuthor = pullRequest.user.login; 

                      // æ·»åŠ å—ç†äºº
                      await github.rest.issues.addAssignees({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        issue_number: pull_number, 
                        assignees: [prOwner]  
                      });

                      // è¯·æ±‚å®¡é˜…
                      if (prOwner !== prAuthor) {
                        await github.rest.pulls.requestReviewers({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          pull_number: pull_number,
                          reviewers: [prOwner] 
                        });
                      } else {
                        console.log(`è·³è¿‡è¯·æ±‚å®¡é˜…ï¼Œå› ä¸º PR çš„ä½œè€…æ˜¯ ${prAuthor}ï¼Œä¹Ÿæ˜¯ä»“åº“æ‹¥æœ‰è€…ï¼Œæ— éœ€å®¡æŸ¥!`);
                      }

                      await github.rest.issues.createComment({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        issue_number: pull_number,
                        body: `@${prAuthor} ä½ å¥½,äººæ°‘çš„å‹¤åŠ¡å‘˜å°†å°½å¿«å®¡æŸ¥åˆå¹¶æ­¤æ¬¡è¯·æ±‚ï¼ğŸš€  [è‡ªåŠ¨å›å¤,è¯·å‹¿è·Ÿå¸–] `
                      });
